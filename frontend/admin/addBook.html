<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Добавить книгу - BookTalks</title>
    <link rel="stylesheet" href="../style_main.css">
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <header class="header">
        Admin Panel - BookTalks
    </header>

    <main class="admin-main">
        <nav class="admin-nav">
            <ul>
                <li><a href="add_book.html">Добавить книгу</a></li>
                <li><a href="addAuthor.html">Добавить автора</a></li>
            </ul>
        </nav>

        <section class="admin-content">
            <h2>Добавить новую книгу</h2>
            <form id="addBookForm" enctype="multipart/form-data">
                <label for="name">Название:</label><br>
                <input type="text" id="name" name="name" required><br><br>

                <label for="author_id">Автор:</label><br>
                <select id="author_id" name="author_id" required>
                    <!-- Авторы будут загружены динамически -->
                </select><br><br>

                <label for="cover_image">Обложка (файл):</label><br>
                <input type="file" id="cover_image" name="cover_image" accept="image/*"><br><br>

                <button type="submit">Добавить</button>
            </form>
            <p id="addBookStatus"></p>
        </section>
    </main>

    <footer>
    </footer>
    <script>
        // Загрузка авторов в select
        async function loadAuthors() {
            const select = document.getElementById('author_id');
            select.innerHTML = '<option value="">Загрузка...</option>';
            try {
                const res = await fetch('../../backend/authors_list.php');
                const data = await res.json();
                select.innerHTML = '<option value="">Выберите автора</option>';
                (data.authors || []).forEach(a => {
                    select.innerHTML += `<option value="${a.id}">${a.first_name} ${a.last_name}</option>`;
                });
            } catch (e) {
                select.innerHTML = '<option value="">Ошибка загрузки авторов</option>';
            }
        }
        loadAuthors();

        // Обработка отправки формы
        const form = document.getElementById('addBookForm');
        form.onsubmit = async function(e) {
            e.preventDefault();
            const status = document.getElementById('addBookStatus');
            status.textContent = '';
            const formData = new FormData(form);
            try {
                const res = await fetch('../../backend/admin_add_book.php', {
                    method: 'POST',
                    body: formData
                });
                const data = await res.json();
                if (data.success) {
                    status.textContent = 'Книга успешно добавлена!';
                    form.reset();
                } else {
                    status.textContent = data.error || 'Ошибка при добавлении книги';
                }
            } catch (err) {
                status.textContent = 'Ошибка при добавлении книги';
            }
        };
    </script>
</body>
</html>